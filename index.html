<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="MCPExNghia Addons - B·ªô s∆∞u t·∫≠p addon ch·∫•t l∆∞·ª£ng cao v·ªõi giao di·ªán Neon Deluxe." />
  <meta name="keywords" content="MCPExNghia, addons, Minecraft, neon, search, ratings" />
  <meta name="author" content="MCPExNghia" />
  <title>MCPExNghia Addons - Neon Final</title>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&display=swap" as="style" onload="this.rel='stylesheet'" />
  <link rel="icon" type="image/png" href="favicon.png" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&family=Roboto:wght@400;700&display=swap');

    :root {
      --violet: #8a3cff;
      --violet-2: #5bd0ff;
      --bg: #050006;
      --card: #110018;
      --glass: rgba(20, 8, 30, 0.6);
      --text: #e8eef8;
      --shadow: rgba(90, 40, 180, 0.2);
      --light: #ffffff;
      --dark: #0a0015;
      --transition: all 0.4s ease;
    }

    [data-theme="light"] {
      --violet: #6a1cff;
      --violet-2: #3bb8ff;
      --bg: #f0f4ff;
      --card: #ffffff;
      --glass: rgba(200, 200, 255, 0.3);
      --text: #1a1a2e;
      --shadow: rgba(0, 0, 50, 0.15);
    }

    *, *:before, *:after { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: 
        radial-gradient(circle at 10% 10%, var(--glass), transparent 15%),
        radial-gradient(circle at 90% 90%, var(--shadow), transparent 15%),
        var(--bg);
      color: var(--text);
      font-family: 'Orbitron', sans-serif;
      overflow-x: hidden;
      transition: var(--transition);
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('https://source.unsplash.com/random/1920x1080?neon') no-repeat center/cover;
      opacity: 0.1;
      z-index: -1;
      transform: translateZ(0);
      transition: opacity var(--transition);
    }

    #intro {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, rgba(12, 2, 30, 0.98), rgba(0, 0, 0, 0.95));
      z-index: 9999;
      animation: introHide 2.5s ease-in-out forwards;
    }
    #intro h1 {
      color: var(--violet);
      font-size: 3rem;
      font-weight: 900;
      margin: 0;
      text-shadow: 0 0 25px var(--violet), 0 0 50px var(--violet-2), 0 0 80px rgba(90, 40, 180, 0.7);
      letter-spacing: 4px;
      animation: glow 1.5s ease-in-out infinite alternate, scaleIn 1.5s ease-out;
      padding: 10px 20px;
      /* B·ªè border v√† background ƒë·ªÉ lo·∫°i b·ªè khung vu√¥ng */
    }
    #intro p {
      margin-top: 16px;
      font-family: 'Roboto', sans-serif;
      color: var(--violet-2);
      font-size: 1.3rem;
      font-weight: 700;
      text-shadow: 0 0 12px var(--violet-2);
      opacity: 0;
      animation: fadeIn 1s ease forwards 1s;
    }

    @keyframes glow {
      from { text-shadow: 0 0 15px var(--violet), 0 0 30px var(--violet-2), 0 0 50px rgba(90, 40, 180, 0.5); }
      to { text-shadow: 0 0 30px var(--violet), 0 0 60px var(--violet-2), 0 0 100px rgba(90, 40, 180, 0.8); }
    }
    @keyframes introHide {
      0% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; visibility: hidden; }
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }
    @keyframes scaleIn {
      from { transform: scale(0.7); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    @keyframes blink-caret {
      from, to { border-color: transparent; }
      50% { border-color: var(--violet-2); }
    }

    header {
      position: sticky;
      top: 0;
      z-index: 50;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
      background: linear-gradient(90deg, var(--glass), var(--shadow));
      border-bottom: 1px solid var(--shadow);
      box-shadow: 0 4px 25px var(--shadow);
      transition: var(--transition);
    }
    header h1 {
      margin: 0;
      color: var(--violet);
      font-size: 1.6rem;
      text-shadow: 0 0 10px var(--violet);
    }
    .menu-icon {
      position: absolute;
      left: 16px;
      font-size: 1.8rem;
      color: var(--violet-2);
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .menu-icon:hover {
      transform: rotate(90deg) scale(1.1);
    }
    .theme-toggle {
      position: absolute;
      right: 16px;
      font-size: 1.6rem;
      color: var(--violet-2);
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .theme-toggle:hover {
      transform: scale(1.1);
    }

    #sidebar {
      position: fixed;
      left: -300px;
      top: 0;
      height: 100%;
      width: 300px;
      background: linear-gradient(180deg, var(--card), var(--dark));
      box-shadow: 10px 0 50px var(--shadow);
      border-right: 1px solid var(--shadow);
      transition: left 0.4s cubic-bezier(0.2, 0.9, 0.2, 1);
      z-index: 2000;
      padding-top: 24px;
      display: flex;
      flex-direction: column;
    }
    #sidebar.active { left: 0; }
    #sidebar .close-btn {
      position: absolute;
      right: 12px;
      top: 12px;
      background: transparent;
      border: none;
      color: var(--violet-2);
      font-size: 1.6rem;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    #sidebar .close-btn:hover { transform: rotate(90deg); }
    #sidebar nav {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 12px 10px;
    }
    #sidebar a {
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 12px 16px;
      border-radius: 8px;
      color: var(--text);
      text-decoration: none;
      margin: 6px 10px;
      transition: background 0.3s, transform 0.3s;
    }
    #sidebar a:hover {
      background: var(--glass);
      transform: translateX(5px);
    }
    #sidebar .icon { font-size: 1.3rem; opacity: 0.95; }
    #sidebar .label { font-size: 1rem; }

    #admin-access {
      margin-top: auto;
      padding: 14px;
      border-top: 1px solid var(--shadow);
    }
    .admin-box {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px 12px;
    }
    .admin-input {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--shadow);
      background: transparent;
      color: var(--text);
      outline: none;
      transition: border 0.3s;
    }
    .admin-input:focus { border-color: var(--violet-2); }
    .admin-btn {
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: linear-gradient(90deg, var(--violet), var(--violet-2));
      color: #000;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .admin-btn:hover { transform: scale(1.05); }
    .admin-btn.secondary {
      background: transparent;
      border: 1px solid var(--shadow);
      color: var(--text);
    }

    #admin-tools {
      display: none;
      margin-top: 10px;
      padding: 10px 8px;
    }
    .admin-tools .tool {
      padding: 10px 12px;
      border-radius: 8px;
      margin: 6px 8px;
      background: var(--glass);
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
    }
    .admin-tools select, .admin-tools input {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid var(--shadow);
      background: transparent;
      color: var(--text);
    }

    main {
      padding: 20px 18px 100px;
      max-width: 1100px;
      margin: 0 auto;
    }
    .search-row {
      display: flex;
      gap: 14px;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }
    .search-input {
      width: 100%;
      max-width: 640px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--shadow);
      background: var(--glass);
      color: var(--text);
      outline: none;
      transition: box-shadow 0.3s, border 0.3s;
    }
    .search-input:focus {
      box-shadow: 0 0 20px var(--shadow);
      border-color: var(--violet-2);
    }
    .filter-options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 16px;
    }
    .filter-btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--shadow);
      background: var(--glass);
      color: var(--text);
      cursor: pointer;
      transition: background 0.3s, transform 0.3s;
    }
    .filter-btn.active, .filter-btn:hover {
      background: var(--violet);
      transform: scale(1.05);
    }

    #addons-container {
      display: flex;
      flex-wrap: wrap;
      gap: 22px;
      justify-content: center;
    }
    .card {
      width: 300px;
      background: linear-gradient(180deg, var(--card), var(--dark));
      border-radius: 12px;
      padding: 14px;
      border: 1px solid var(--shadow);
      box-shadow: 0 6px 22px var(--shadow);
      transition: transform 0.28s, box-shadow 0.28s;
      overflow: hidden;
      position: relative;
      z-index: 1;
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 16px 40px var(--shadow);
    }
    .card .img-container {
      width: 100%;
      height: 160px;
      overflow: hidden;
      border-radius: 8px;
      position: relative;
      margin-bottom: 10px;
    }
    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 0;
    }
    .card h3 {
      margin: 10px 0 6px;
      color: var(--violet-2);
      font-size: 1.3rem;
      z-index: 2;
      position: relative;
    }
    .card p {
      margin: 0;
      color: var(--text);
      font-size: 0.95rem;
      height: 44px;
      overflow: hidden;
      font-family: 'Roboto', sans-serif;
      z-index: 2;
      position: relative;
    }
    .card .cta {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      justify-content: center;
      position: relative;
      z-index: 3;
      padding: 8px 0;
    }
    .btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      background: linear-gradient(90deg, var(--violet), var(--violet-2));
      color: #000;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.3s;
      text-decoration: none;
      display: inline-block;
      z-index: 3;
    }
    .btn:hover { transform: scale(1.05); }
    .btn.secondary {
      background: transparent;
      border: 1px solid var(--shadow);
      color: var(--text);
    }

    .rating {
      display: flex;
      gap: 4px;
      justify-content: center;
      margin-top: 8px;
      position: relative;
      z-index: 2;
    }
    .star {
      font-size: 1.1rem;
      cursor: pointer;
      opacity: 0.85;
      transition: transform 0.3s;
    }
    .star:hover { transform: scale(1.2); }
    .star.fill {
      color: gold;
      text-shadow: 0 0 8px gold;
    }
    .avg-score {
      font-size: 0.9rem;
      color: var(--text);
      margin-left: 8px;
    }

    #popup {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.8);
      z-index: 3000;
      padding: 20px;
    }
    .popup-card {
      width: 100%;
      max-width: 680px;
      background: linear-gradient(180deg, var(--card), var(--dark));
      border-radius: 12px;
      padding: 18px;
      border: 1px solid var(--shadow);
      box-shadow: 0 30px 80px var(--shadow);
      position: relative;
      overflow: hidden;
    }
    .popup-card .img-container {
      width: 100%;
      height: 300px;
      overflow: hidden;
      border-radius: 8px;
      position: relative;
      margin-bottom: 12px;
    }
    .popup-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }
    .popup-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      gap: 12px;
    }
    .comments {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed var(--shadow);
    }
    .comment-list {
      max-height: 180px;
      overflow: auto;
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .comment {
      background: var(--glass);
      padding: 8px;
      border-radius: 8px;
      border: 1px solid var(--shadow);
    }
    .comment .meta {
      font-size: 0.8rem;
      color: rgba(200, 200, 255, 0.7);
    }
    .comment .body {
      margin-top: 6px;
      color: var(--text);
      font-family: 'Roboto', sans-serif;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 8px;
      background: var(--violet);
      color: #fff;
      box-shadow: 0 4px 15px var(--shadow);
      z-index: 4000;
      opacity: 0;
      transform: translateY(20px);
      animation: toastIn 0.4s ease forwards, toastOut 0.4s ease 2.5s forwards;
    }
    @keyframes toastIn {
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes toastOut {
      to { opacity: 0; transform: translateY(20px); }
    }

    footer {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px;
      background: linear-gradient(90deg, var(--glass), var(--shadow));
      border-top: 1px solid var(--shadow);
      text-align: center;
      color: var(--text);
      font-size: 0.9rem;
      font-family: 'Roboto', sans-serif;
    }

    @media (max-width: 720px) {
      .card { width: 90%; }
      #sidebar { width: 86%; left: -100%; }
      #sidebar.active { left: 0; }
      .popup-card .img-container { height: 240px; }
      .card .img-container { height: 140px; }
      #intro h1 { font-size: 2.2rem; }
      #intro p { font-size: 1.1rem; }
    }
    @media (max-width: 480px) {
      header h1 { font-size: 1.4rem; }
      .card .img-container { height: 120px; }
      .popup-card .img-container { height: 200px; }
      #intro h1 { font-size: 1.8rem; letter-spacing: 2px; }
      #intro p { font-size: 0.9rem; }
      .card { padding: 12px; }
      .btn { padding: 8px 10px; font-size: 0.9rem; }
    }

    .card { animation: floatCard 8s ease-in-out infinite; }
    @keyframes floatCard {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
    }
  </style>
</head>
<body data-theme="dark">
  <div id="intro" aria-hidden="true">
    <h1 id="typewriter"></h1>
    <p id="subline">Neon Deluxe ‚Äî Cold Violet</p>
  </div>

  <header>
    <div class="menu-icon" onclick="toggleSidebar()">‚ò∞</div>
    <h1>‚ö° MCPExNghia Addons</h1>
    <div class="theme-toggle" onclick="toggleTheme()">üåô</div>
  </header>

  <aside id="sidebar" aria-hidden="true">
    <button class="close-btn" onclick="toggleSidebar()">‚úï</button>
    <nav>
      <a href="#"><span class="icon">üè†</span><span class="label">Trang ch·ªß</span></a>
      <a href="#addons-container"><span class="icon">üß©</span><span class="label">Addons</span></a>
      <a href="#"><span class="icon">üìû</span><span class="label">Li√™n h·ªá</span></a>
      <a href="#"><span class="icon">üí°</span><span class="label">Gi·ªõi thi·ªáu</span></a>
    </nav>
    <div id="admin-tools" class="admin-tools" aria-hidden="true">
      <div style="padding:10px 14px;color:var(--violet-2);font-weight:700">‚öôÔ∏è Admin Tools</div>
      <div class="tool"><div>‚ûï Th√™m Addon</div><button class="btn" onclick="openAddForm()">M·ªü</button></div>
      <div class="tool"><div>üé® Chuy·ªÉn theme</div>
        <select id="themeSelect" onchange="applyTheme(this.value)">
          <option value="violet">Violet Cold</option>
          <option value="emerald">Emerald</option>
          <option value="red">Crimson</option>
        </select>
      </div>
      <div class="tool"><div>üö™ ƒêƒÉng xu·∫•t</div><button class="btn" onclick="logoutAdmin()">Tho√°t</button></div>
    </div>
    <div id="admin-access">
      <div style="padding:10px 14px;color:var(--text);font-weight:700">üîí Admin Access</div>
      <div class="admin-box">
        <input id="adminKeyInput" class="admin-input" placeholder="Nh·∫≠p key admin..." />
        <div style="display:flex;gap:10px">
          <button class="admin-btn" onclick="tryAdmin()">X√°c nh·∫≠n</button>
          <button class="admin-btn secondary" onclick="toggleSidebar()">ƒê√≥ng</button>
        </div>
        <div id="admin-msg" style="font-size:0.9rem;color:rgba(200,200,255,0.6)"></div>
      </div>
    </div>
  </aside>

  <main>
    <div class="search-row">
      <input id="searchInput" class="search-input" placeholder="T√¨m addon theo t√™n, m√¥ t·∫£ ho·∫∑c danh m·ª•c..." oninput="applyFilter()" aria-label="T√¨m ki·∫øm addon" />
    </div>
    <div class="filter-options">
      <button class="filter-btn active" data-filter="all" aria-pressed="true">T·∫•t c·∫£</button>
      <button class="filter-btn" data-filter="popular" aria-pressed="false">Ph·ªï bi·∫øn</button>
      <button class="filter-btn" data-filter="new" aria-pressed="false">M·ªõi nh·∫•t</button>
      <button class="filter-btn" data-filter="high-rated" aria-pressed="false">ƒê√°nh gi√° cao</button>
    </div>
    <section id="addons-container" aria-live="polite"></section>
  </main>

  <div id="popup" role="dialog" aria-modal="true">
    <div class="popup-card">
      <div class="img-container">
        <img id="popupImg" src="" alt="Addon image" loading="lazy" />
      </div>
      <div class="popup-meta">
        <div>
          <h2 id="popupName" style="margin:0;color:var(--violet-2)"></h2>
          <p id="popupDesc" style="margin:6px 0;color:var(--text)"></p>
          <div id="popupRating"></div>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
          <a id="popupLink" class="btn" href="#" target="_blank" onclick="return validateDownload(this.href)">‚¨áÔ∏è T·∫£i v·ªÅ</a>
          <button class="btn secondary" onclick="closePopup()">ƒê√≥ng</button>
        </div>
      </div>
      <div class="comments">
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <input id="commentName" placeholder="T√™n (t√πy ch·ªçn)" style="flex:1;padding:8px;border-radius:8px;border:1px solid var(--shadow);background:transparent;color:var(--text)" />
          <input id="commentText" placeholder="Vi·∫øt b√¨nh lu·∫≠n..." style="flex:2;padding:8px;border-radius:8px;border:1px solid var(--shadow);background:transparent;color:var(--text)" />
          <button class="btn" onclick="addComment()">G·ª≠i</button>
        </div>
        <div class="comment-list" id="commentList"></div>
      </div>
    </div>
  </div>

  <div id="toast-container"></div>

  <footer>¬© 2025 MCPExNghia | Neon Deluxe ‚Ä¢ Powered by xAI</footer>

  <script>
    const SECRET_KEY = 'mcpexnghia2025';
    let addons = [];
    let currentPopupIndex = null;
    let isAdmin = false;
    let currentFilter = '';
    let currentCategory = 'all';

    // Typewriter effect for intro
    const text = "‚ö° MCPExNghia Addons";
    let idx = 0;
    function typeEffect() {
      const el = document.getElementById('typewriter');
      if (!el) return;
      if (idx < text.length) {
        el.textContent = text.slice(0, idx + 1);
        idx++;
        setTimeout(typeEffect, 80);
      } else {
        document.getElementById('subline').style.opacity = 1;
        setTimeout(() => {
          const intro = document.getElementById('intro');
          intro.style.transition = 'opacity 1.5s ease';
          intro.style.opacity = '0';
          setTimeout(() => intro.style.display = 'none', 1500);
        }, 1000);
      }
    }

    window.addEventListener('load', () => {
      const el = document.getElementById('typewriter');
      if (el) {
        el.style.color = 'var(--violet)';
        el.style.textShadow = '0 0 25px var(--violet), 0 0 50px var(--violet-2)';
        el.style.fontSize = '3rem';
        el.style.fontWeight = '900';
        el.style.letterSpacing = '4px';
        el.style.borderRight = '4px solid var(--violet-2)';
        el.style.paddingRight = '10px';
        el.style.animation = 'blink-caret 0.8s step-end infinite';
        typeEffect();
      }
      loadAddons();
      applyTheme('violet');
    });

    // Theme toggle
    function toggleTheme() {
      const body = document.body;
      const currentTheme = body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      body.setAttribute('data-theme', currentTheme);
      showToast(`Chuy·ªÉn sang ch·∫ø ƒë·ªô ${currentTheme === 'dark' ? 'T·ªëi' : 'S√°ng'}`);
    }

    // Toast notification
    function showToast(message) {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Sidebar toggle
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
    }

    // Admin functions
    function openAddForm() {
      const html = `
        <div style="padding:10px">
          <input id="newName" placeholder="T√™n addon" style="width:100%;padding:8px;border-radius:6px;margin-bottom:8px;background:transparent;border:1px solid var(--shadow);color:var(--text)" />
          <input id="newDesc" placeholder="M√¥ t·∫£" style="width:100%;padding:8px;border-radius:6px;margin-bottom:8px;background:transparent;border:1px solid var(--shadow);color:var(--text)" />
          <input id="newImg" placeholder="URL ·∫£nh" style="width:100%;padding:8px;border-radius:6px;margin-bottom:8px;background:transparent;border:1px solid var(--shadow);color:var(--text)" />
          <input id="newLink" placeholder="Link t·∫£i" style="width:100%;padding:8px;border-radius:6px;margin-bottom:8px;background:transparent;border:1px solid var(--shadow);color:var(--text)" />
          <input id="newCategory" placeholder="Danh m·ª•c (v√≠ d·ª•: popular, new)" style="width:100%;padding:8px;border-radius:6px;margin-bottom:8px;background:transparent;border:1px solid var(--shadow);color:var(--text)" />
          <div style="display:flex;gap:8px;justify-content:flex-end">
            <button class="btn" onclick="saveNewAddon()">L∆∞u</button>
            <button class="btn secondary" onclick="renderAddons()">H·ªßy</button>
          </div>
        </div>
      `;
      const adminTools = document.getElementById('admin-tools');
      const container = document.createElement('div');
      container.innerHTML = html;
      adminTools.prepend(container);
    }

    function saveNewAddon() {
      const name = document.getElementById('newName').value.trim();
      const desc = document.getElementById('newDesc').value.trim();
      const img = document.getElementById('newImg').value.trim();
      const link = document.getElementById('newLink').value.trim();
      const category = document.getElementById('newCategory').value.trim().toLowerCase();
      if (!name || !img) {
        showToast('Vui l√≤ng ƒëi·ªÅn √≠t nh·∫•t t√™n v√† URL ·∫£nh');
        return;
      }
      const obj = { name, description: desc || 'No description', image: img, download: link || '#', category: category || 'all' };
      const custom = JSON.parse(localStorage.getItem('addons_custom') || '[]');
      custom.push(obj);
      localStorage.setItem('addons_custom', JSON.stringify(custom));
      loadAddons();
      showToast('‚úÖ Addon m·ªõi ƒë√£ ƒë∆∞·ª£c th√™m');
    }

    function tryAdmin() {
      const val = document.getElementById('adminKeyInput').value.trim();
      if (val === SECRET_KEY) {
        isAdmin = true;
        document.getElementById('admin-tools').style.display = 'block';
        document.getElementById('admin-msg').innerText = '‚úÖ Admin mode active';
        showToast('ƒê√£ k√≠ch ho·∫°t ch·∫ø ƒë·ªô admin');
      } else {
        document.getElementById('admin-msg').innerText = '‚ùå Key sai';
        showToast('Key admin kh√¥ng ƒë√∫ng');
      }
    }

    function logoutAdmin() {
      isAdmin = false;
      document.getElementById('admin-tools').style.display = 'none';
      document.getElementById('adminKeyInput').value = '';
      document.getElementById('admin-msg').innerText = 'ƒê√£ ƒëƒÉng xu·∫•t';
      showToast('ƒê√£ ƒëƒÉng xu·∫•t admin');
    }

    function applyTheme(name) {
      if (name === 'emerald') {
        document.documentElement.style.setProperty('--violet', '#0fb36b');
        document.documentElement.style.setProperty('--violet-2', '#74ffd1');
      } else if (name === 'red') {
        document.documentElement.style.setProperty('--violet', '#ff4b6e');
        document.documentElement.style.setProperty('--violet-2', '#ffb86e');
      } else {
        document.documentElement.style.setProperty('--violet', '#8a3cff');
        document.documentElement.style.setProperty('--violet-2', '#5bd0ff');
      }
      showToast(`ƒê√£ chuy·ªÉn sang theme ${name}`);
    }

    // Filter and search
    function applyFilter() {
      currentFilter = document.getElementById('searchInput').value.trim().toLowerCase();
      renderAddons();
    }

    function applyCategoryFilter(category) {
      currentCategory = category;
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.filter-btn[data-filter="${category}"]`).classList.add('active');
      renderAddons();
    }

    // Ratings
    function ratingsKey(index) { return 'ratings_addon_' + index; }
    function userRatingKey(index) { return 'rating_user_' + index; }

    function getRatings(index) {
      const raw = localStorage.getItem(ratingsKey(index));
      return raw ? JSON.parse(raw) : { sum: 0, count: 0, user: null };
    }

    function saveRatings(index, obj) {
      localStorage.setItem(ratingsKey(index), JSON.stringify(obj));
    }

    function getUserRating(index) {
      const raw = localStorage.getItem(userRatingKey(index));
      return raw ? Number(raw) : null;
    }

    function setUserRating(index, val) {
      localStorage.setItem(userRatingKey(index), String(val));
    }

    function rateAddon(index, value) {
      const r = getRatings(index);
      const prev = getUserRating(index);
      if (prev) {
        r.sum = r.sum - prev + value;
      } else {
        r.sum += value;
        r.count += 1;
      }
      setUserRating(index, value);
      saveRatings(index, r);
      renderAddons();
      if (currentPopupIndex === index) {
        renderPopupRating(index);
      }
      showToast(`ƒê√£ ƒë√°nh gi√° ${value} sao`);
    }

    function renderRatingStars(containerEl, index, small = false) {
      const r = getRatings(index);
      const avg = r.count ? (r.sum / r.count) : 0;
      const user = getUserRating(index);
      containerEl.innerHTML = '';
      for (let s = 1; s <= 5; s++) {
        const span = document.createElement('span');
        span.className = 'star' + ((user && s <= user) || (!user && Math.round(avg) >= s) ? ' fill' : '');
        span.innerText = '‚òÖ';
        span.title = user ? `B·∫°n ƒë√£ ƒë√°nh gi√°: ${user}` : `ƒê√°nh gi√° ${s} sao`;
        span.onclick = (e) => { e.stopPropagation(); rateAddon(index, s); };
        containerEl.appendChild(span);
      }
      const avgEl = document.createElement('span');
      avgEl.className = 'avg-score';
      avgEl.innerText = r.count ? ` ${(r.sum / r.count).toFixed(1)} (${r.count} l∆∞·ª£t)` : ' Ch∆∞a c√≥ ƒë√°nh gi√°';
      containerEl.appendChild(avgEl);
    }

    function renderPopupRating(index) {
      let ratingContainer = document.getElementById('popupRating');
      if (!ratingContainer) {
        ratingContainer = document.createElement('div');
        ratingContainer.id = 'popupRating';
        ratingContainer.style.marginTop = '8px';
        document.querySelector('.popup-meta div').appendChild(ratingContainer);
      }
      renderRatingStars(ratingContainer, index);
    }

    // Render addons
    function renderAddons() {
      const container = document.getElementById('addons-container');
      container.innerHTML = '';
      const merged = [...addons].concat(JSON.parse(localStorage.getItem('addons_custom') || '[]'));
      const filtered = merged.filter(a => {
        const q = currentFilter;
        const hay = (a.name + ' ' + (a.description || '') + ' ' + (a.category || '')).toLowerCase();
        const matchSearch = q ? hay.includes(q) : true;
        const matchCategory = currentCategory === 'all' || a.category === currentCategory || 
          (currentCategory === 'popular' && getRatings(merged.indexOf(a)).count > 5) ||
          (currentCategory === 'high-rated' && getRatings(merged.indexOf(a)).count > 0 && (getRatings(merged.indexOf(a)).sum / getRatings(merged.indexOf(a)).count) >= 4);
        return matchSearch && matchCategory;
      });
      if (filtered.length === 0) {
        container.innerHTML = '<p style="text-align:center;color:var(--text)">Kh√¥ng t√¨m th·∫•y addon n√†o.</p>';
        return;
      }
      filtered.forEach((a, i) => {
        if (!a.name || !a.image) return;
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <div class="img-container">
            <img src="${a.image}" alt="${a.name}" loading="lazy" onerror="this.src='https://via.placeholder.com/300x160?text=Addon';this.alt='H√¨nh ·∫£nh kh√¥ng t·∫£i ƒë∆∞·ª£c'" />
          </div>
          <h3>${a.name}</h3>
          <p>${a.description || ''}</p>
          <div class="cta">
            <button class="btn" onclick="openPopup(${merged.indexOf(a)})">Chi ti·∫øt</button>
            <a class="btn secondary" href="${a.download || '#'}" target="_blank" onclick="return validateDownload(this.href)">‚¨áÔ∏è T·∫£i</a>
          </div>
          <div class="rating" id="rating_card_${merged.indexOf(a)}"></div>
        `;
        container.appendChild(div);
        renderRatingStars(document.getElementById(`rating_card_${merged.indexOf(a)}`), merged.indexOf(a), true);
      });
      observeCards();
    }

    // Lazy loading observer
    function observeCards() {
      const cards = document.querySelectorAll('.card');
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = 1;
            entry.target.style.transform = 'translateY(0)';
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1 });
      cards.forEach(card => {
        card.style.opacity = 0;
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        observer.observe(card);
      });
    }

    // Validate download link
    function validateDownload(href) {
      if (href === '#' || !href) {
        showToast('Link t·∫£i kh√¥ng kh·∫£ d·ª•ng');
        return false;
      }
      return true;
    }

    async function loadAddons() {
      try {
        const res = await fetch('addons.json', { cache: 'no-cache' });
        if (!res.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i addons.json');
        const data = await res.json();
        addons = data;
      } catch (e) {
        console.warn('Kh√¥ng th·ªÉ load addons.json ‚Äî d√πng local n·∫øu c√≥', e);
        addons = [];
        showToast('Kh√¥ng th·ªÉ t·∫£i danh s√°ch addon, ki·ªÉm tra k·∫øt n·ªëi ho·∫∑c file addons.json');
      }
      renderAddons();
    }

    // Popup
    function openPopup(index) {
      currentPopupIndex = index;
      const merged = [...addons].concat(JSON.parse(localStorage.getItem('addons_custom') || '[]'));
      const a = merged[index];
      if (!a) return;
      document.getElementById('popupImg').src = a.image;
      document.getElementById('popupName').innerText = a.name;
      document.getElementById('popupDesc').innerText = a.description || '';
      document.getElementById('popupLink').href = a.download || '#';
      document.getElementById('popup').style.display = 'flex';
      renderPopupRating(index);
      loadCommentsFor(index);
      document.querySelector('.comment-list').scrollTop = 0;
    }

    function closePopup() {
      document.getElementById('popup').style.display = 'none';
      currentPopupIndex = null;
    }

    // Comments
    function getCommentsKey(index) { return 'comments_addon_' + index; }

    function loadCommentsFor(index) {
      const key = getCommentsKey(index);
      const list = JSON.parse(localStorage.getItem(key) || '[]');
      const container = document.getElementById('commentList');
      container.innerHTML = '';
      if (list.length === 0) {
        container.innerHTML = '<div style="color:rgba(200,200,255,0.6)">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o</div>';
        return;
      }
      list.forEach(c => {
        const el = document.createElement('div');
        el.className = 'comment';
        el.innerHTML = `
          <div class="meta">${escapeHtml(c.name || 'Ng∆∞·ªùi d√πng')} ‚Ä¢ ${new Date(c.t).toLocaleString()}</div>
          <div class="body">${escapeHtml(c.text)}</div>
        `;
        container.appendChild(el);
      });
    }

    function addComment() {
      if (currentPopupIndex === null) return;
      const name = document.getElementById('commentName').value.trim() || 'Ng∆∞·ªùi d√πng';
      const text = document.getElementById('commentText').value.trim();
      if (!text) {
        showToast('Vui l√≤ng nh·∫≠p n·ªôi dung b√¨nh lu·∫≠n');
        return;
      }
      const key = getCommentsKey(currentPopupIndex);
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      arr.unshift({ name, text, t: Date.now() });
      localStorage.setItem(key, JSON.stringify(arr));
      document.getElementById('commentText').value = '';
      loadCommentsFor(currentPopupIndex);
      showToast('‚úÖ B√¨nh lu·∫≠n ƒë√£ ƒë∆∞·ª£c th√™m');
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"'`]/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;', '`': '&#96;' })[m]);
    }

    // Event listeners
    document.getElementById('popup').addEventListener('click', (e) => {
      if (e.target.id === 'popup') closePopup();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const sb = document.getElementById('sidebar');
        if (sb.classList.contains('active')) sb.classList.remove('active');
        const p = document.getElementById('popup');
        if (p.style.display === 'flex') closePopup();
      }
    });

    // Filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => applyCategoryFilter(btn.getAttribute('data-filter')));
    });

    // Initial load
    window.addEventListener('load', () => {
      setTimeout(() => document.getElementById('intro').style.display = 'none', 2500);
      applyCategoryFilter('all');
    });
  </script>
</body>
</html>